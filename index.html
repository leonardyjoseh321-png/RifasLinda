<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifas Sucre</title>
    <!-- Agrega esta meta tag para offline -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client"></script>

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="manifest" href="./manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div id="app">
        <div id="acceso-container" class="container">
    <h1>Rifas Sucre</h1>
    <div class="input-group">
        <input type="text" id="codigo-acceso" placeholder="Código de acceso (8 dígitos)" maxlength="8">
        <button id="btn-acceder">Acceder</button>
    </div>
    <div class="button-group">
        <button id="btn-superusuario">Superusuario</button>
        <button id="btn-contacto">Contacto <i class="fab fa-whatsapp"></i></button>
        <button id="btn-manual">
            <i class="fas fa-book"></i> Manual
        </button>
        <!-- NUEVO BOTÓN PARA LIBERAR CÓDIGO -->
        <button id="btn-liberar-codigo" style="background-color: #e67e22;">
            <i class="fas fa-unlock"></i> Liberar Código
        </button>
    </div>
</div>

        <div id="main-container" class="container hidden">
    <div class="header">
        <h1 id="app-title">Rifas Sucre</h1>
        <div class="rifa-activa" id="rifa-activa-info"></div>
        
        <!-- NUEVO BUSCADOR DE NÚMEROS GANADORES -->
        <div class="buscador-ganador">
            <div class="input-group-ganador">
                <input type="text" id="numero-ganador-buscar" placeholder="Buscar número ganador (ej: 005)" maxlength="3">
                <button id="btn-buscar-ganador"><i class="fas fa-search"></i> Buscar Ganador</button>
            </div>
        </div>
               <div class="menu">
    <button id="btn-rifas"><i class="fas fa-ticket-alt"></i> Rifas</button>
    <button id="btn-clientes"><i class="fas fa-users"></i> Clientes</button>
    <button id="btn-respaldo"><i class="fas fa-database"></i> Respaldo</button>
    <button id="btn-seguridad" class="hidden"><i class="fas fa-lock"></i> Seguridad</button>
    <button id="btn-cambiar-nombre"><i class="fas fa-edit"></i> Cambiar Nombre</button>
    <button id="btn-plantilla-factura"><i class="fas fa-file-invoice"></i> Plantilla Factura</button>
    <button id="btn-clientes-permanentes"><i class="fas fa-address-book"></i> Clientes Permanentes</button>
    <button id="btn-salir"><i class="fas fa-sign-out-alt"></i> Salir</button>
</div>
            </div>

            <div id="rifas-section" class="content-section">
                <!-- Contenido de Rifas -->
            </div>

            <div id="clientes-section" class="content-section hidden">
                <!-- Contenido de Clientes -->
            </div>

            <div id="respaldo-section" class="content-section hidden">
    <h2>Respaldo de Datos</h2>
    <p>Aquí puedes crear una copia de seguridad de todos tus datos o restaurar desde una copia previa.</p>
    
    <div class="respaldo-acciones">
        <button id="btn-crear-respaldo"><i class="fas fa-save"></i> Crear Respaldo Local</button>
        <button id="btn-restaurar-respaldo"><i class="fas fa-upload"></i> Restaurar Respaldo Local</button>
        <button id="btn-google-drive-backup"><i class="fab fa-google-drive"></i> Guardar en Google Drive</button>
        <button id="btn-google-drive-restore"><i class="fab fa-google-drive"></i> Restaurar desde Google Drive</button>
    </div>
    
    <div id="google-drive-section" class="hidden" style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 5px;">
        <h3>Conexión con Google Drive</h3>
        <div class="form-group">
            <label for="google-email">Correo electrónico de Google:</label>
            <input type="email" id="google-email" placeholder="tu.correo@gmail.com" style="width: 100%; padding: 10px;">
        </div>
        <button id="btn-connect-google" style="background: #4285F4; color: white;">
            <i class="fab fa-google"></i> Conectar con Google
        </button>
        <div id="google-status" style="margin-top: 10px; font-size: 14px;"></div>
    </div>
</div>

            <div id="seguridad-section" class="content-section hidden">
                <!-- Contenido de Seguridad -->
            </div>
        </div>
    </div>

    <!-- Modal de Superusuario -->
    <div id="superusuario-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Acceso Superusuario</h2>
            <input type="password" id="superusuario-clave" placeholder="Clave de superusuario">
            <button id="btn-superusuario-acceder">Acceder</button>
        </div>
    </div>

<!-- Modal del Manual -->
<div id="manual-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
        <span class="close-modal">&times;</span>
        <h2>Manual de Usuario - Sistema de Gestión de Rifas</h2>
        <div id="manual-content" style="overflow-y: auto; max-height: 80vh; padding-right: 10px;">
            <!-- El contenido se insertará aquí con JavaScript -->
        </div>
    </div>
</div>

    <!-- Modal de Cuadrícula Completa -->
    <div id="cuadricula-modal" class="modal hidden">
        <div class="modal-content full-grid">
            <span class="close-modal">&times;</span>
            <h2 id="modal-rifa-title"></h2>
            <div class="filtros">
    <button class="filtro-btn active" data-filtro="todos">Todos</button>
    <button class="filtro-btn" data-filtro="disponibles">Disponibles</button>
    <button class="filtro-btn" data-filtro="apartados">Apartados</button>
    <button class="filtro-btn" data-filtro="abonados">Abonados</button>
    <button class="filtro-btn" data-filtro="pagados">Pagados</button>
    <button id="descargar-cuadricula"><i class="fas fa-download"></i> Descargar Imagen</button>
    <div class="tamanio-cuadros">
        <label for="tamanio-cuadros">Tamaño cuadros:</label>
        <input type="range" id="tamanio-cuadros" min="20" max="60" value="40" step="5">
        <span id="tamanio-valor">40px</span>
    </div>
</div>
            <div id="cuadricula-completa" class="cuadricula-container"></div>
        </div>
    </div>

    <!-- Modal para cambiar nombre del programa -->
    <div id="nombre-modal" class="modal hidden">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Cambiar Nombre del Programa</h2>
        <div class="form-group">
            <label for="nuevo-nombre">Nuevo nombre:</label>
            <input type="text" id="nuevo-nombre" placeholder="Ej: Rifas Mi Negocio">
        </div>
        <button id="btn-guardar-nombre">Guardar</button>
    </div>
</div>

    <!-- Modal de Cliente -->
    <div id="cliente-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="cliente-modal-title">Nuevo Cliente</h2>
            <div class="form-group">
                <label for="cliente-nombre">Nombre:</label>
                <input type="text" id="cliente-nombre" placeholder="Nombre completo">
            </div>
            <div class="form-group">
                <label for="cliente-telefono">Teléfono:</label>
                <input type="text" id="cliente-telefono" placeholder="Ej: +584245244171">
            </div>
            <div class="form-group">
                <label for="cliente-numeros">Números (separados por comas):</label>
                <input type="text" id="cliente-numeros" placeholder="Ej: 001,005,010">
            </div>
            <div class="form-group">
                <label for="cliente-estado">Estado:</label>
                <select id="cliente-estado">
                    <option value="apartado">Apartado</option>
                    <option value="pagado">Pagado</option>
                </select>
            </div>
            <button id="btn-guardar-cliente">Guardar</button>
        </div>
    </div>

<div id="plantilla-factura-modal" class="modal hidden">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Plantilla de Factura</h2>
        <div class="form-group">
            <label for="factura-titulo">Título:</label>
            <input type="text" id="factura-titulo" placeholder="Ej: FACTURA DE VENTA" value="FACTURA DE VENTA">
        </div>
        <div class="form-group">
            <label for="factura-encabezado">Encabezado:</label>
            <textarea id="factura-encabezado" rows="3" placeholder="Información de tu negocio">${localStorage.getItem('nombreApp') || 'Rifas Sucre'}\nTeléfono: \nDirección: </textarea>
        </div>
        <div class="form-group">
    <label for="factura-cuerpo">Cuerpo (usa {variables}):</label>
    <textarea id="factura-cuerpo" rows="5">Cliente: {nombre}\nRifa: {rifa}\nNúmeros: {numeros}\nCantidad: {cantidad}\nPrecio unitario: {precio}\nTotal: {total}</textarea>
    <div class="variables-guia">
        <h4>Variables disponibles:</h4>
        <div class="variables-lista">
            <span class="variable-tag">{nombre}</span>
            <span class="variable-tag">{rifa}</span>
            <span class="variable-tag">{numeros}</span>
            <span class="variable-tag">{cantidad}</span>
            <span class="variable-tag">{precio}</span>
            <span class="variable-tag">{total}</span>
            <span class="variable-tag">{fecha}</span>
            <span class="variable-tag">{hora}</span>
            <span class="variable-tag">{pagado}</span>
            <span class="variable-tag">{deuda}</span>
        </div>
    </div>
</div>
        <div class="form-group">
            <label for="factura-pie">Pie de página:</label>
            <textarea id="factura-pie" rows="3" placeholder="Mensaje final">¡Gracias por su compra!\nVálido como factura</textarea>
        </div>
        <button id="btn-guardar-plantilla-factura">Guardar Plantilla</button>
    </div>
</div>

<!-- Modal de Confirmación de Impresión -->
<div id="imprimir-factura-modal" class="modal hidden">
    <div class="modal-content small">
        <h2>Imprimir Factura</h2>
        <div class="form-group">
            <label for="tamano-impresion">Tamaño de impresión:</label>
            <select id="tamano-impresion">
                <option value="58">58mm (Ticket pequeño)</option>
                <option value="80" selected>80mm (Factura estándar)</option>
            </select>
        </div>
        <div class="confirmacion-botones">
            <button id="btn-imprimir-factura" style="background-color: #27ae60;">Imprimir</button>
            <button id="btn-cancelar-impresion" style="background-color: #e74c3c;">Cancelar</button>
        </div>
    </div>
</div>

    <!-- Modal de Mensaje Plantilla -->
<div id="plantilla-modal" class="modal hidden">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Plantillas de Mensaje</h2>
        
        <div class="tab-container">
    <div class="tab-buttons">
        <button class="tab-btn active" data-tab="whatsapp">WhatsApp</button>
        <button class="tab-btn" data-tab="rezagados">Rezagados</button>
        <button class="tab-btn" data-tab="ganador">Ganador</button>
    </div>
    
    <div class="tab-content active" id="whatsapp-tab">
        <h3>Plantilla WhatsApp</h3>
        <textarea id="plantilla-mensaje" rows="10"></textarea>
        <div class="variables-guia">
            <h4>Variables disponibles:</h4>
            <div class="variables-lista">
                <span class="variable-tag">{nombre}</span>
                <span class="variable-tag">{rifa}</span>
                <span class="variable-tag">{numeros}</span>
                <span class="variable-tag">{estado}</span>
                <span class="variable-tag">{fecha}</span>
                <span class="variable-tag">{hora}</span>
                <span class="variable-tag">{total}</span>
                <span class="variable-tag">{pagado}</span>
                <span class="variable-tag">{deuda}</span>
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="rezagados-tab">
        <h3>Plantilla Rezagados</h3>
        <textarea id="plantilla-rezagados" rows="10"></textarea>
        <div class="variables-guia">
            <h4>Variables disponibles:</h4>
            <div class="variables-lista">
                <span class="variable-tag">{nombre}</span>
                <span class="variable-tag">{rifa}</span>
                <span class="variable-tag">{numeros}</span>
                <span class="variable-tag">{estado}</span>
                <span class="variable-tag">{fecha}</span>
                <span class="variable-tag">{total}</span>
                <span class="variable-tag">{pagado}</span>
                <span class="variable-tag">{deuda}</span>
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="ganador-tab">
        <h3>Plantilla Ganador</h3>
        <textarea id="plantilla-ganador" rows="10"></textarea>
        <div class="variables-guia">
            <h4>Variables disponibles:</h4>
            <div class="variables-lista">
                <span class="variable-tag">{nombre}</span>
                <span class="variable-tag">{rifa}</span>
                <span class="variable-tag">{numeroGanador}</span>
                <span class="variable-tag">{estado}</span>
                <span class="variable-tag">{fecha}</span>
            </div>
        </div>
    </div>
</div>
        
        <button id="btn-guardar-plantilla">Guardar Plantillas</button>
    </div>
</div>

    <!-- Modal de Rifa -->
    <div id="rifa-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="rifa-modal-title">Nueva Rifa</h2>
            <div class="form-group">
                <label for="rifa-nombre">Nombre:</label>
                <input type="text" id="rifa-nombre" placeholder="Nombre de la rifa">
            </div>
            <div class="form-group">
                <label for="rifa-total">Total de números:</label>
                <input type="number" id="rifa-total" min="1" placeholder="Ej: 100">
            </div>
            <div class="form-group">
                <label for="rifa-columnas">Columnas:</label>
                <input type="number" id="rifa-columnas" min="1" placeholder="Ej: 10">
            </div>
            <div class="form-group">
            <label for="rifa-por-grilla">Números por grilla:</label>
            <input type="number" id="rifa-por-grilla" min="1" placeholder="Ej: 25">
        </div>
        <div class="form-group">
            <label for="rifa-precio">Precio por número:</label>
            <input type="number" id="rifa-precio" min="1" placeholder="Ej: 100" step="any">
        </div>
        <button id="btn-guardar-rifa">Guardar</button>
        </div>
    </div>

    <!-- Modal de Seguridad -->
    <div id="seguridad-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Generar Código de Acceso</h2>
            <div class="form-group">
                <label for="codigo-duracion">Duración (días):</label>
                <input type="number" id="codigo-duracion" min="1" value="1">
            </div>
            <button id="btn-generar-codigo">Generar Código</button>
            <div id="codigo-generado-container" class="hidden">
                <p>Código generado:</p>
                <div id="codigo-generado" class="codigo-box"></div>
                <p>Este código es de un solo uso y expirará después del tiempo especificado.</p>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación -->
    <!-- Modal de Confirmación -->
<div id="confirmacion-modal" class="modal hidden">
    <div class="modal-content small">
        <h2 id="confirmacion-titulo"></h2>
        <p id="confirmacion-mensaje"></p>
        <div class="confirmacion-botones">
            <button id="confirmacion-si">Sí</button>
            <button id="confirmacion-no">No</button>
        </div>
    </div>
</div>

<!-- NUEVO: Modal de Código Expirado -->
<div id="expirado-modal" class="modal hidden">
    <div class="modal-content small">
        <h2>Código Expirado</h2>
        <p>Tu código de acceso ha expirado. Debes ingresar un nuevo código válido para continuar usando la aplicación.</p>
        <div class="confirmacion-botones">
            <button id="btn-entendido-expirado">Entendido</button>
        </div>
    </div>
</div>

<!-- Modal de Opciones CSV -->
<div id="csv-modal" class="modal hidden">
    <div class="modal-content small">
        <span class="close-modal">&times;</span>
        <h2>Opciones CSV</h2>
        <div class="button-group" style="flex-direction: column; gap: 10px;">
            <button id="btn-descargar-csv" style="background-color: #27ae60;">
                <i class="fas fa-download"></i> Descargar CSV
            </button>
            <button id="btn-generador-cuadriculas" style="background-color: #3498db;">
                <i class="fas fa-external-link-alt"></i> Generador de Cuadrículas
            </button>
        </div>
    </div>
</div>

<!-- Modal para Plantilla de Ticket -->
<div id="plantilla-ticket-modal" class="modal hidden">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Plantilla de Ticket y WhatsApp</h2>
        
        <div class="form-group">
            <label for="plantilla-ticket-titulo">Título del Ticket:</label>
            <input type="text" id="plantilla-ticket-titulo" placeholder="Ej: TICKET DE RIFA">
        </div>
        
        <div class="form-group">
            <label for="plantilla-ticket-mensaje">Mensaje del Ticket (usa {variables}):</label>
            <textarea id="plantilla-ticket-mensaje" rows="8" placeholder="Ej: Cliente: {nombre}\nNúmeros: {numeros}"></textarea>
        </div>
        
        <div class="form-group">
            <label for="plantilla-whatsapp-mensaje">Mensaje de WhatsApp (se enviará automáticamente):</label>
            <textarea id="plantilla-whatsapp-mensaje" rows="8" placeholder="Ej: ¡Hola {nombre}! Aquí tienes tu ticket de la rifa {rifa}"></textarea>
            <small>Este mensaje se enviará automáticamente al abrir WhatsApp</small>
        </div>
        
        <div class="variables-guia">
            <h4>Variables disponibles:</h4>
            <div class="variables-lista">
                <span class="variable-tag">{nombre}</span>
                <span class="variable-tag">{rifa}</span>
                <span class="variable-tag">{numeros}</span>
                <span class="variable-tag">{estado}</span>
                <span class="variable-tag">{fecha}</span>
                <span class="variable-tag">{hora}</span>
                <span class="variable-tag">{total}</span>
                <span class="variable-tag">{pagado}</span>
                <span class="variable-tag">{deuda}</span>
                <span class="variable-tag">{telefono}</span>
            </div>
        </div>
        
        <button id="btn-guardar-plantilla-ticket">Guardar Plantillas</button>
    </div>
</div>

<!-- Modal para ver/editar clientes permanentes -->
<div id="clientes-permanentes-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 800px;">
        <span class="close-modal">&times;</span>
        <h2>Base de Datos de Clientes Permanentes</h2>
        
        <div class="form-group">
            <input type="text" id="buscar-cliente-permanente" placeholder="Buscar por nombre, teléfono o número..." style="width: 100%;">
        </div>
        
        <div style="max-height: 500px; overflow-y: auto; margin-bottom: 20px;">
            <table id="tabla-clientes-permanentes" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f2f2f2;">
                        <th style="padding: 10px; text-align: left;">N° Cliente</th>
                        <th style="padding: 10px; text-align: left;">Nombre</th>
                        <th style="padding: 10px; text-align: left;">Teléfono</th>
                        <th style="padding: 10px; text-align: left;">Acciones</th>
                    </tr>
                </thead>
                <tbody id="lista-clientes-permanentes">
                    <!-- Aquí se cargarán los clientes -->
                </tbody>
            </table>
        </div>
        
        <div class="button-group">
            <button id="btn-exportar-clientes"><i class="fas fa-file-export"></i> Guardar Clientes</button>
            <button id="btn-importar-clientes"><i class="fas fa-file-import"></i> Restaurar Clientes</button>
        </div>
    </div>
</div>

<!-- Modal de Número Ganador -->
<div id="ganador-modal" class="modal hidden">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>¡Número Ganador Encontrado!</h2>
        
        <div class="info-ganador">
            <div class="ganador-item">
                <strong>Número:</strong> <span id="ganador-numero">000</span>
            </div>
            <div class="ganador-item">
                <strong>Estado:</strong> <span id="ganador-estado" class="estado-ganador">PAGADO ✓</span>
            </div>
            <div class="ganador-item">
                <strong>Cliente:</strong> <span id="ganador-cliente">Nombre del cliente</span>
            </div>
            <div class="ganador-item">
                <strong>Teléfono:</strong> <span id="ganador-telefono">000-000-0000</span>
            </div>
            <div class="ganador-item">
                <strong>Rifa:</strong> <span id="ganador-rifa">Nombre de la rifa</span>
            </div>
            <div class="ganador-item">
                <strong>Total de números del cliente:</strong> <span id="ganador-total-numeros">0</span>
            </div>
            <div class="ganador-item">
                <strong>Abonado:</strong> <span id="ganador-abonado">$0.00</span>
            </div>
        </div>
        
        <div class="acciones-ganador">
            <button id="btn-whatsapp-ganador" class="btn-whatsapp">
                <i class="fab fa-whatsapp"></i> Enviar WhatsApp de Felicitaciones
            </button>
        </div>
    </div>
</div>

<!-- Modal para Google Drive -->
<div id="google-drive-modal" class="modal hidden">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Google Drive</h2>
        <div id="google-drive-content">
            <p>Conectando con Google Drive...</p>
        </div>
    </div>
</div>

<!-- Modal para Planilla C Flash -->
<div id="c-flash-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 95vw; max-height: 95vh; width: 720px; height: 1280px;">
        <span class="close-modal">&times;</span>
        <h2>Planilla C Flash - Rifa Activa</h2>
        
        <div class="c-flash-controls" style="margin: 10px 0; display: flex; gap: 10px; align-items: center;">
            <button id="btn-descargar-c-flash" style="background-color: #27ae60; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-download"></i> Descargar Planilla
            </button>
            
            <div class="quality-options" style="display: flex; gap: 10px; align-items: center;">
                <label for="c-flash-quality">Calidad:</label>
                <select id="c-flash-quality" style="padding: 5px;">
                    <option value="1">Alta</option>
                    <option value="0.9">Buena</option>
                    <option value="0.7">Media</option>
                    <option value="0.5">Baja</option>
                </select>
                
                <label for="c-flash-scale">Escala:</label>
                <select id="c-flash-scale" style="padding: 5px;">
                    <option value="3">3x</option>
                    <option value="2">2x</option>
                    <option value="1.5">1.5x</option>
                    <option value="1">1x</option>
                </select>
            </div>
        </div>

        <div class="c-flash-container" id="c-flash-content" style="width: 720px; height: 1280px; background-color: white; padding: 15px; position: relative; overflow: hidden;">
            <!-- La planilla se generará aquí dinámicamente -->
        </div>
    </div>
</div>

    <script src="script.js"></script> 
    <script src="install.js"></script>
</body>
</html>
